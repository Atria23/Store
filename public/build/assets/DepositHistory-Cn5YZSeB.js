import{r as o,W as S,j as e}from"./app-BXFBHTz3.js";const C=({deposits:j})=>{const[p,l]=o.useState(!1),[x,d]=o.useState(null),[h,u]=o.useState(j),[r,m]=o.useState(null),[f,g]=o.useState(null),{post:b}=S();o.useEffect(()=>{const t=setInterval(()=>{u(s=>s.map(n=>n.status==="pending"&&n.expires_at&&new Date(n.expires_at)-new Date<=0?{...n,status:"expired"}:n))},1e3);return()=>clearInterval(t)},[]);const y=t=>{const s=new Date(t)-new Date;if(s<=0)return"Expired";const n=Math.floor(s/(1e3*60*60)),a=Math.floor(s%(1e3*60*60)/(1e3*60)),i=Math.floor(s%(1e3*60)/1e3);return`${n.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`},N=t=>{confirm("Are you sure you want to confirm this deposit?")&&(l(!0),d(t),b(`/deposit/confirm/${t}`,{},{onSuccess:()=>{alert("Deposit confirmed successfully!"),l(!1),d(null)},onError:()=>{alert("Failed to confirm deposit."),l(!1),d(null)}}))},_=t=>{m(t)},w=()=>{m(null)},D=(t,s)=>{if(!s)return;g(t);const n=new FormData;n.append("proof_of_payment",s),fetch(`/deposit/upload-proof/${t}`,{method:"POST",body:n,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}).then(a=>a.json()).then(a=>{a.success?(alert("Proof of payment uploaded successfully!"),u(i=>i.map(c=>c.id===t?{...c,proof_of_payment:a.proof_of_payment}:c))):alert("Failed to upload proof of payment.")}).catch(a=>{console.error("Error uploading proof:",a),alert("An error occurred while uploading proof.")}).finally(()=>g(null))};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Deposit History"}),e.jsx("a",{href:"/deposit/create",children:e.jsx("span",{className:"px-2 py-1 rounded bg-blue-100 text-blue-600",children:"Create Deposit"})}),h.length===0?e.jsx("p",{children:"No deposits found."}):e.jsxs("table",{className:"min-w-full bg-white border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border px-4 py-2",children:"#"}),e.jsx("th",{className:"border px-4 py-2",children:"Get Saldo"}),e.jsx("th",{className:"border px-4 py-2",children:"Total Pay"}),e.jsx("th",{className:"border px-4 py-2",children:"Status"}),e.jsx("th",{className:"border px-4 py-2",children:"Expires In"}),e.jsx("th",{className:"border px-4 py-2",children:"Proof of Payment"}),e.jsx("th",{className:"border px-4 py-2",children:"Actions"})]})}),e.jsx("tbody",{children:h.map(t=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"border px-4 py-2",children:t.id}),e.jsx("td",{className:"border px-4 py-2",children:t.get_saldo}),e.jsx("td",{className:"border px-4 py-2",children:t.total_pay}),e.jsx("td",{className:"border px-4 py-2",children:e.jsx("span",{className:`px-2 py-1 rounded ${t.status==="pending"?"bg-yellow-100 text-yellow-600":t.status==="confirmed"?"bg-green-100 text-green-600":"bg-red-100 text-red-600"}`,children:t.status})}),e.jsx("td",{className:"border px-4 py-2",children:t.status==="pending"?y(t.expires_at):"Expired"}),e.jsx("td",{className:"border px-4 py-2",children:t.proof_of_payment?e.jsx("a",{href:t.proof_of_payment,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:"View Proof"}):e.jsxs("div",{children:[e.jsx("input",{type:"file",accept:"image/*",onChange:s=>D(t.id,s.target.files[0]),disabled:f===t.id,className:"text-sm"}),f===t.id&&e.jsx("p",{children:"Uploading..."})]})}),e.jsxs("td",{className:"border px-4 py-2 space-y-2",children:[e.jsx("button",{onClick:()=>_(t),className:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-700",children:"View Details"}),t.status==="pending"&&e.jsx("button",{onClick:()=>N(t.id),className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-700",disabled:p&&x!==t.id,children:p&&x===t.id?"Loading...":"Confirm"})]})]},t.id))})]}),r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded shadow-lg max-w-md w-full",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Deposit Details"}),e.jsxs("p",{children:[e.jsx("strong",{children:"ID:"})," ",r.id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Amount:"})," ",r.amount]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Unique Code:"})," ",r.unique_code]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total Pay:"})," ",r.total_pay]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Admin Fee:"})," ",r.admin_fee]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Get Saldo:"})," ",r.get_saldo]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",e.jsx("span",{className:`px-2 py-1 rounded ${r.status==="pending"?"bg-yellow-100 text-yellow-600":r.status==="confirmed"?"bg-green-100 text-green-600":"bg-red-100 text-red-600"}`,children:r.status})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Expires At:"})," ",new Date(r.expires_at).toLocaleString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Created At:"})," ",new Date(r.created_at).toLocaleString()]}),r.proof_of_payment&&e.jsxs("p",{children:[e.jsx("strong",{children:"Proof of Payment:"})," ",e.jsx("a",{href:deposit.proof_of_payment,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:"View Proof"})]}),e.jsx("button",{onClick:w,className:"bg-red-500 text-white px-4 py-2 rounded hover:bg-red-700 mt-4",children:"Close"})]})})]})};export{C as default};
