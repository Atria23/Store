import{r as n,j as e,a as K}from"./app-B8qUc3Hr.js";const G=5e5;function W({products:z}){var T,M,A,B,L,D;const[x,N]=n.useState(""),[d,w]=n.useState(null),[v,k]=n.useState(""),[l,h]=n.useState(null),[a,u]=n.useState(null),[o,p]=n.useState(!1),[m,i]=n.useState(null),[P,j]=n.useState(!1),[g,S]=n.useState(""),[y,E]=n.useState(!1),[_,J]=n.useState(G),[q,F]=n.useState(0),b=n.useRef(null);n.useEffect(()=>{b.current&&F(b.current.offsetHeight)},[d,l,a]),n.useEffect(()=>{m&&i(null)},[x,g,d]);const r=s=>{let t=0;if(typeof s=="number"||typeof s=="string"){const R=parseFloat(s);isNaN(R)||(t=R)}const c=Math.ceil(t);return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(c)},I=async s=>{if(s.preventDefault(),!d){i("Silakan pilih produk PDAM terlebih dahulu.");return}p(!0),i(null),h(null),u(null);try{const t=await fetch(route("pascapdam.inquiry"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"application/json"},body:JSON.stringify({customer_no:x,buyer_sku_code:d.buyer_sku_code})}),c=await t.json();if(!t.ok)throw new Error(c.message||"Gagal melakukan pengecekan tagihan.");h(c)}catch(t){i(t.message)}finally{p(!1)}},O=()=>{i(null),j(!0)},H=async s=>{if(s.preventDefault(),!l){i("Data tagihan tidak ditemukan.");return}p(!0),i(null),u(null);try{const t=await fetch(route("pascapdam.payment"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"application/json"},body:JSON.stringify({customer_no:l.customer_no,password:g})}),c=await t.json();if(!t.ok)throw new Error(c.message||"Gagal melakukan pembayaran.");u(c),h(null),j(!1),S("")}catch(t){i(t.message)}finally{p(!1)}},C=z.filter(s=>s.product_name.toLowerCase().includes(v.toLowerCase())),f=()=>{w(null),N(""),h(null),i(null),u(null),k("")};return e.jsxs(e.Fragment,{children:[e.jsx(K,{title:"Bayar Tagihan PDAM"}),e.jsxs("div",{className:"mx-auto w-full max-w-[500px] min-h-screen bg-gray-50",children:[e.jsxs("header",{ref:b,className:"fixed top-0 left-1/2 -translate-x-1/2 max-w-[500px] w-full z-10 bg-white shadow-lg",children:[e.jsxs("div",{className:"w-full h-max flex flex-row space-x-4 justify-start items-center px-4 py-3 bg-main",children:[e.jsx("button",{className:"shrink-0 w-6 h-6",onClick:()=>l||a?f():window.history.back(),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"white",className:"w-6 h-6",children:e.jsx("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})})}),e.jsx("div",{className:"font-semibold text-white text-lg",children:"Tagihan PDAM"})]}),!l&&!a&&e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"w-full h-9 flex flex-row mx-auto items-center justify-center pr-2 py-2 rounded-lg bg-neutral-100 border-2 border-gray-200",children:[e.jsx("input",{type:"text",className:"bg-transparent border-none flex-grow focus:ring-0 focus:outline-none placeholder-gray-400",placeholder:"Cari wilayah PDAM...",value:v,onChange:s=>k(s.target.value)}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",stroke:"currentColor",strokeWidth:"0.3",className:"w-5 h-5 text-main",children:e.jsx("path",{d:"M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16a6.471 6.471 0 0 0 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zM9.5 14A4.5 4.5 0 1 1 14 9.5 4.505 4.505 0 0 1 9.5 14z"})})]}),d&&e.jsxs("form",{onSubmit:I,className:"space-y-3",children:[e.jsxs("div",{className:"border-t pt-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Produk Pilihan:"}),e.jsx("p",{className:"font-bold text-blue-700",children:d.product_name})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"customer_no",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nomor Pelanggan"}),e.jsx("input",{id:"customer_no",type:"number",value:x,onChange:s=>N(s.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",disabled:o,required:!0,placeholder:"Masukkan nomor pelanggan"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{type:"button",onClick:f,className:"w-full bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-gray-300",children:"Pilih Ulang"}),e.jsx("button",{type:"submit",disabled:o||!x,className:"w-full bg-main text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 disabled:bg-gray-400",children:o?"Mengecek...":"Cek Tagihan"})]})]})]})]}),e.jsx("main",{style:{paddingTop:`${q}px`,paddingBottom:l?"100px":"16px"},className:"p-4 transition-all duration-200",children:e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border mt-4",children:[a?a.status==="Sukses"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-green-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-800 mt-2",children:"Pembayaran Berhasil"}),e.jsx("p",{className:"text-sm text-gray-500",children:a.message})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Pembayaran"}),e.jsx("p",{className:"text-3xl font-bold text-main",children:r(a.selling_price)})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx("h4",{className:"font-semibold text-md text-gray-800 pb-1 border-b",children:"Detail Pelanggan"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Nama Pelanggan"}),e.jsx("span",{className:"font-medium text-right",children:a.customer_name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Nomor Pelanggan"}),e.jsx("span",{className:"font-medium",children:a.customer_no})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Alamat"}),e.jsx("span",{className:"font-medium text-right",children:(T=a.desc)==null?void 0:T.alamat})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Jumlah Tagihan"}),e.jsxs("span",{className:"font-medium",children:[(M=a.desc)==null?void 0:M.lembar_tagihan," Lembar"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Jatuh Tempo"}),e.jsx("span",{className:"font-medium",children:(A=a.desc)==null?void 0:A.jatuh_tempo})]})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsx("h4",{className:"font-semibold text-md text-gray-800 pb-1 border-b",children:"Rincian Pembayaran"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Tarif"}),e.jsx("span",{className:"font-medium",children:(B=a.desc)==null?void 0:B.tarif})]}),(D=(L=a.desc)==null?void 0:L.detail)==null?void 0:D.map((s,t)=>e.jsxs("div",{className:"space-y-1 pt-2 border-t border-dashed",children:[e.jsxs("p",{className:"font-semibold text-gray-700",children:["Periode: ",s.periode]}),e.jsxs("div",{className:"pl-2 space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Meter Awal - Akhir"})," ",e.jsxs("span",{className:"font-medium",children:[s.meter_awal," - ",s.meter_akhir]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Nilai Tagihan"})," ",e.jsx("span",{className:"font-medium",children:r(s.nilai_tagihan)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Denda"})," ",e.jsx("span",{className:"font-medium",children:r(s.denda)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Biaya Lainnya"})," ",e.jsx("span",{className:"font-medium",children:r(s.biaya_lain)})]})]})]},t)),e.jsxs("div",{className:"space-y-1 pt-2 border-t",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Tagihan Pokok"}),e.jsx("span",{className:"font-medium",children:r(a.selling_price-a.admin)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Biaya Admin"}),e.jsx("span",{className:"font-medium",children:r(a.admin)})]})]})]}),e.jsxs("div",{className:"space-y-1 text-xs text-gray-500 bg-gray-100 p-3 rounded-md",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Serial Number (SN)"}),e.jsx("span",{className:"font-mono",children:a.sn})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Ref ID"}),e.jsx("span",{className:"font-mono",children:a.ref_id})]})]}),e.jsx("button",{onClick:f,className:"w-full py-2 px-4 bg-main text-white font-semibold rounded-lg hover:bg-blue-700",children:"Lakukan Transaksi Lain"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-red-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-800 mt-2",children:"Pembayaran Gagal"}),e.jsx("p",{className:"text-sm text-red-700 bg-red-50 p-3 mt-2 rounded-lg",children:a.message})]}),e.jsx("button",{onClick:f,className:"w-full py-2 px-4 bg-main text-white font-semibold rounded-lg hover:bg-blue-700",children:"Coba Lagi"})]}):l?e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"w-full font-semibold text-md text-center text-gray-800 border-b pb-3",children:"Detail Tagihan"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx("h4",{className:"font-semibold text-gray-800",children:"Detail Pelanggan"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Nomor Pelanggan"}),e.jsx("span",{className:"font-medium text-gray-900",children:l.customer_no})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Nama Pelanggan"}),e.jsx("span",{className:"font-medium text-gray-900 text-right",children:l.customer_name})]})]}),e.jsx("div",{className:"w-full h-px bg-gray-100"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx("h4",{className:"font-semibold text-gray-800",children:"Rincian Biaya"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Tagihan Pokok"}),e.jsx("span",{className:"font-medium text-gray-900",children:r(l.price-l.admin)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Biaya Admin"}),e.jsx("span",{className:"font-medium text-gray-900",children:r(l.admin)})]})]}),e.jsx("div",{className:"w-full h-px bg-gray-200"}),e.jsxs("div",{className:"flex justify-between items-center pt-2",children:[e.jsx("span",{className:"font-semibold text-gray-800 text-lg",children:"Total Pembayaran"}),e.jsx("span",{className:"font-bold text-xl text-main",children:r(l.selling_price)})]})]}):e.jsx("div",{className:"grid grid-cols-2 gap-3",children:C.length>0?C.map(s=>{const t=!s.seller_product_status,c=d&&d.id===s.id;return e.jsxs("div",{onClick:()=>!t&&w(s),className:`flex flex-col justify-between p-3 border rounded-lg shadow-sm transition-all duration-200 ${t?"bg-gray-200 opacity-70 cursor-not-allowed":"bg-white cursor-pointer hover:shadow-lg"} ${c?"border-main ring-2 ring-blue-500":"border-gray-200"}`,children:[e.jsx("h3",{className:"text-utama text-xs font-semibold line-clamp-2 mb-2",children:s.product_name}),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("p",{className:"text-gray-500 text-xs",children:"Admin"}),e.jsx("p",{className:"text-main text-sm font-bold",children:r(s.calculated_admin)}),t&&e.jsx("p",{className:"text-xs text-red-500 mt-1 font-medium",children:"Gangguan"})]})]},s.id)}):e.jsx("p",{className:"col-span-2 text-center text-gray-500 pt-4",children:"Produk tidak ditemukan."})}),m&&!P&&e.jsx("p",{className:"text-red-500 text-sm text-center pt-4",children:m})]})}),l&&!a&&e.jsx("footer",{className:"fixed bottom-0 left-1/2 -translate-x-1/2 w-full max-w-[500px] p-4 bg-white shadow-[0_-2px_5px_rgba(0,0,0,0.1)] rounded-t-xl",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Pembayaran"}),e.jsx("p",{className:"text-xl font-bold text-main",children:r(l.selling_price)})]}),e.jsx("button",{onClick:O,disabled:_<l.selling_price,className:"px-6 py-2 rounded-lg font-semibold text-white bg-main hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed",children:_<l.selling_price?"Saldo Kurang":"Bayar Sekarang"})]})}),P&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-sm space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-center",children:"Konfirmasi Pembayaran"}),e.jsxs("form",{onSubmit:H,children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:y?"text":"password",value:g,onChange:s=>S(s.target.value),className:"w-full border p-2 pr-10 rounded",placeholder:"Masukkan password Anda",autoFocus:!0,required:!0}),e.jsx("button",{type:"button",onClick:()=>E(!y),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500",children:y?e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"currentColor",viewBox:"0 0 16 16",children:[e.jsx("path",{d:"m10.79 12.912-1.614-1.615a3.5 3.5 0 0 1-4.474-4.474l-2.06-2.06C.938 6.278 0 8 0 8s3 5.5 8 5.5a7 7 0 0 0 2.79-.588M5.21 3.088A7 7 0 0 1 8 2.5c5 0 8 5.5 8 5.5s-.939 1.721-2.641 3.238l-2.062-2.062a3.5 3.5 0 0 0-4.474-4.474z"}),e.jsx("path",{d:"M5.525 7.646a2.5 2.5 0 0 0 2.829 2.829zm4.95.708-2.829-2.83a2.5 2.5 0 0 1 2.829 2.829zm3.171 6-12-12 .708-.708 12 12z"})]}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"currentColor",viewBox:"0 0 16 16",children:[e.jsx("path",{d:"M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0"}),e.jsx("path",{d:"M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8m8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7"})]})})]}),m&&e.jsx("p",{className:"text-red-500 text-xs text-center pt-2",children:m}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>j(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg",children:"Batal"}),e.jsx("button",{type:"submit",disabled:o||!g,className:"px-4 py-2 text-sm font-medium text-white bg-main hover:bg-blue-700 rounded-lg disabled:bg-gray-400",children:o?"Memproses...":"Konfirmasi"})]})]})]})})]})]})}export{W as default};
