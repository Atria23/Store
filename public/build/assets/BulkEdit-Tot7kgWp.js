import{r as m,j as e,a as w,d as k,y as N}from"./app-C4HWBaj7.js";function F({auth:S,postpaidProducts:x,errors:c={},flash:P={}}){const[a,b]=m.useState({desc:"",seller_product_status:"",buyer_product_status:"",commission_sell_percentage:"",commission_sell_fixed:"",image:null,imagePreview:null}),[o,u]=m.useState([]),[g,p]=m.useState(!1);m.useEffect(()=>{const s=x.map(l=>({id:l.id,product_name:l.product_name,buyer_sku_code:l.buyer_sku_code,desc:l.desc||"",seller_product_status:l.seller_product_status?"1":"0",buyer_product_status:l.buyer_product_status?"1":"0",commission_sell_percentage:l.commission_sell_percentage??"",commission_sell_fixed:l.commission_sell_fixed??"",image:null,imagePreview:l.image?`/storage/${l.image}`:null,original:{desc:l.desc||"",seller_product_status:l.seller_product_status?"1":"0",buyer_product_status:l.buyer_product_status?"1":"0",commission_sell_percentage:l.commission_sell_percentage??"",commission_sell_fixed:l.commission_sell_fixed??"",image:null}}));u(s)},[x]);const n=(s,l)=>{b(t=>({...t,[s]:l}))},v=s=>{const l=s.target.files[0];l&&b(t=>({...t,image:l,imagePreview:URL.createObjectURL(l)}))},j=()=>{const s={};if(a.desc.trim()!==""&&(s.desc=a.desc),a.seller_product_status!==""&&(s.seller_product_status=a.seller_product_status),a.buyer_product_status!==""&&(s.buyer_product_status=a.buyer_product_status),a.commission_sell_percentage!==""&&(s.commission_sell_percentage=a.commission_sell_percentage),a.commission_sell_fixed!==""&&(s.commission_sell_fixed=a.commission_sell_fixed),a.image!==null&&(s.image=a.image,s.imagePreview=a.imagePreview),Object.keys(s).length===0){alert("Tidak ada input di form 'Terapkan ke Semua' untuk diterapkan.");return}u(l=>l.map(t=>({...t,...s})))},d=(s,l,t)=>{u(i=>i.map(r=>{if(r.id===s){const _={...r,[l]:t};return l==="image"&&t instanceof File&&(_.imagePreview=URL.createObjectURL(t)),_}return r}))},f=s=>s.image instanceof File?!0:Object.keys(s.original).some(l=>l!=="image"&&String(s[l])!==String(s.original[l])),y=s=>{s.preventDefault();const l=o.filter(t=>f(t)).map(t=>{const i={};return Object.keys(t.original).forEach(r=>{r==="image"&&t.image instanceof File?i.image=t.image:r!=="image"&&String(t[r])!==String(t.original[r])&&(i[r]=t[r])}),i.commission_sell_percentage===""&&(i.commission_sell_percentage=null),i.commission_sell_fixed===""&&(i.commission_sell_fixed=null),i.seller_product_status!==void 0&&(i.seller_product_status=i.seller_product_status==="1"),i.buyer_product_status!==void 0&&(i.buyer_product_status=i.buyer_product_status==="1"),i.image===null&&delete i.image,Object.keys(i).length>0?{id:t.id,updates:i}:null}).filter(Boolean);if(l.length===0){alert("Tidak ada perubahan untuk disimpan.");return}N.post(route("postpaid.bulk-update"),{ids:l.map(t=>t.id),individual_updates:l},{onStart:()=>p(!0),onFinish:()=>p(!1),onError:t=>{console.error("Update failed:",t),alert("Gagal memperbarui produk. Periksa pesan error di form.")},preserveScroll:!0})},h=o.length>1?`Edit Massal ${o.length} Produk`:"Edit Produk";return e.jsxs(e.Fragment,{children:[e.jsx(w,{title:h}),e.jsxs("div",{className:"mx-auto w-full max-w-[500px] min-h-screen bg-gray-50",children:[e.jsx("div",{className:"fixed top-0 left-1/2 -translate-x-1/2 max-w-[500px] w-full z-10 bg-main shadow-md",children:e.jsxs("div",{className:"w-full h-max flex flex-row space-x-4 justify-start items-center px-4 py-3",children:[e.jsx(k,{href:route("postpaid.index"),className:"shrink-0 w-6 h-6",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"white",className:"w-6 h-6",children:e.jsx("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})})}),e.jsx("div",{className:"font-semibold text-white text-lg",children:h})]})}),e.jsx("div",{className:"pt-20 pb-24 px-4",children:e.jsxs("form",{onSubmit:y,children:[o.length>1&&e.jsxs("div",{className:"p-4 bg-white rounded-lg mb-6 border border-gray-200 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Terapkan ke Semua"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Deskripsi"}),e.jsx("textarea",{value:a.desc,onChange:s=>n("desc",s.target.value),className:"form-textarea block w-full rounded-md shadow-sm sm:text-sm border-gray-300 focus:ring-blue-500 focus:border-blue-500",rows:"3"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status Seller"}),e.jsxs("select",{value:a.seller_product_status,onChange:s=>n("seller_product_status",s.target.value),className:"form-select block w-full rounded-md shadow-sm sm:text-sm border-gray-300 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Pilih"}),e.jsx("option",{value:"1",children:"Aktif"}),e.jsx("option",{value:"0",children:"Nonaktif"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status Buyer"}),e.jsxs("select",{value:a.buyer_product_status,onChange:s=>n("buyer_product_status",s.target.value),className:"form-select block w-full rounded-md shadow-sm sm:text-sm border-gray-300 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Pilih"}),e.jsx("option",{value:"1",children:"Aktif"}),e.jsx("option",{value:"0",children:"Nonaktif"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Komisi %"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"99",placeholder:"0.00",value:a.commission_sell_percentage,onChange:s=>n("commission_sell_percentage",s.target.value),className:"form-input block w-full rounded-md shadow-sm sm:text-sm border-gray-300 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Komisi Tetap"}),e.jsx("input",{type:"number",min:"0",placeholder:"0",value:a.commission_sell_fixed,onChange:s=>n("commission_sell_fixed",s.target.value),className:"form-input block w-full rounded-md shadow-sm sm:text-sm border-gray-300 focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Gambar"}),a.imagePreview&&e.jsx("img",{src:a.imagePreview,alt:"Preview",className:"w-20 h-20 object-cover mt-1 mb-2 rounded"}),e.jsx("input",{type:"file",accept:"image/*",onChange:v,className:"mt-1 block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-violet-50 file:text-violet-700 hover:file:bg-violet-100"})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 flex justify-end",children:e.jsx("button",{type:"button",onClick:j,className:"w-full text-center px-4 py-2 bg-main border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-blue-700",children:"Terapkan Perubahan Ini ke Semua"})})]}),e.jsx("div",{className:"space-y-4",children:o.map((s,l)=>e.jsxs("div",{className:`p-4 bg-white rounded-lg border shadow-sm ${f(s)?"border-yellow-400":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4 pb-4 border-b",children:[e.jsx("img",{src:s.imagePreview||"/storage/brands/default.webp",alt:s.product_name,className:"aspect-square w-12 h-12 rounded-lg object-cover bg-gray-100"}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("p",{className:"font-semibold text-sm text-gray-800",children:s.product_name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.buyer_sku_code})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Deskripsi"}),e.jsx("textarea",{value:s.desc,onChange:t=>d(s.id,"desc",t.target.value),className:"form-textarea block w-full rounded-md shadow-sm sm:text-sm border-gray-300 focus:ring-blue-500 focus:border-blue-500",rows:"3"}),c[`individual_updates.${l}.updates.desc`]&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:c[`individual_updates.${l}.updates.desc`]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status Seller"}),e.jsxs("select",{value:s.seller_product_status,onChange:t=>d(s.id,"seller_product_status",t.target.value),className:"form-select block w-full rounded-md shadow-sm sm:text-sm border-gray-300 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"1",children:"Aktif"}),e.jsx("option",{value:"0",children:"Nonaktif"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status Buyer"}),e.jsxs("select",{value:s.buyer_product_status,onChange:t=>d(s.id,"buyer_product_status",t.target.value),className:"form-select block w-full rounded-md shadow-sm sm:text-sm border-gray-300 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"1",children:"Aktif"}),e.jsx("option",{value:"0",children:"Nonaktif"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Komisi %"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"99",placeholder:"0.00",value:s.commission_sell_percentage,onChange:t=>d(s.id,"commission_sell_percentage",t.target.value),className:"form-input block w-full rounded-md shadow-sm sm:text-sm border-gray-300 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Komisi Tetap"}),e.jsx("input",{type:"number",min:"0",placeholder:"0",value:s.commission_sell_fixed,onChange:t=>d(s.id,"commission_sell_fixed",t.target.value),className:"form-input block w-full rounded-md shadow-sm sm:text-sm border-gray-300 focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ganti Gambar"}),e.jsx("input",{type:"file",accept:"image/*",onChange:t=>d(s.id,"image",t.target.files[0]),className:"block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-violet-50 file:text-violet-700 hover:file:bg-violet-100"}),c[`individual_updates.${l}.updates.image`]&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:c[`individual_updates.${l}.updates.image`]})]})]})]},s.id))}),e.jsx("div",{className:"fixed bottom-0 left-1/2 -translate-x-1/2 w-full max-w-[500px] p-4 bg-white border-t border-gray-200",children:e.jsx("button",{type:"submit",className:"w-full px-6 py-3 bg-main text-white font-semibold rounded-md hover:bg-blue-700 disabled:opacity-50",disabled:g,children:g?"Menyimpan...":"Simpan Semua Perubahan"})})]})})]})]})}export{F as default};
