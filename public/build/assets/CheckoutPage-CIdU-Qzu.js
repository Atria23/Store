import{r as a,j as e}from"./app-BLuH1zmA.js";function R({product:s,balance:o}){const[b,f]=a.useState(""),[k,g]=a.useState(s.price),[u,N]=a.useState(""),[i,j]=a.useState("Tidak tersedia"),[T,d]=a.useState(!1),[c,y]=a.useState(""),[p,t]=a.useState(""),[w,h]=a.useState(!1);a.useEffect(()=>{const n=new URLSearchParams(window.location.search),l=n.get("customerNo"),x=n.get("phone");j(l||x||"Tidak tersedia")},[]);const S=()=>{N("Saat ini belum ada promo tersedia."),g(s.price)},r=Number(k)+Number(s.admin||0)-Number(s.discount||0),v=()=>{if(o<r){t("Saldo tidak mencukupi untuk melakukan transaksi.");return}h(!0)},C=async n=>{if(n.preventDefault(),t(""),!s||i==="Tidak tersedia"){t("Mohon lengkapi nomor pelanggan dan pilih produk.");return}if(o<r){t("Saldo tidak mencukupi untuk melakukan transaksi.");return}if(!c){t("Silakan masukkan password untuk melanjutkan.");return}d(!0);try{if(!(await(await fetch("/auth/verify-password",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({password:c})})).json()).success){t("Password salah. Silakan coba lagi."),d(!1);return}const m=await(await fetch("/transactions",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({buyer_sku_code:s.buyer_sku_code,customer_no:i,max_price:r,price_product:s.price,testing:!1})})).json();m.success?alert(`Transaksi berhasil: ${m.message}`):t(`Transaksi gagal: ${m.message}`)}catch(l){console.error("Error:",l),t("Terjadi kesalahan saat mengirim permintaan transaksi.")}finally{d(!1)}};return e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Checkout"}),e.jsxs("div",{className:"border rounded-lg p-4 shadow-md bg-white",children:[e.jsx("h3",{className:"text-lg font-semibold",children:s.product_name}),e.jsxs("p",{className:"text-gray-600",children:["ID Tujuan: ",i]}),e.jsxs("p",{className:"text-lg font-bold",children:["Harga: Rp ",new Intl.NumberFormat("id-ID").format(s.price)]}),e.jsxs("p",{className:"text-lg",children:["Admin: Rp ",new Intl.NumberFormat("id-ID").format(s.admin||0)]}),e.jsxs("p",{className:"text-lg text-red-500",children:["Diskon: Rp ",new Intl.NumberFormat("id-ID").format(s.discount||0)]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block font-semibold",children:"Total Pembayaran:"}),e.jsxs("p",{children:["Rp ",new Intl.NumberFormat("id-ID").format(r)]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block font-semibold",children:"Saldo Anda:"}),e.jsxs("p",{className:"text-lg font-bold",children:["Rp ",new Intl.NumberFormat("id-ID").format(o)]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block font-semibold",children:"Kode Promo:"}),e.jsx("input",{type:"text",value:b,onChange:n=>f(n.target.value),className:"w-full border p-2 rounded mt-1",placeholder:"Masukkan kode promo"}),e.jsx("button",{onClick:S,className:"mt-2 bg-blue-500 text-white px-4 py-2 rounded w-full",children:"Terapkan Kode Promo"}),u&&e.jsx("p",{className:"mt-2 text-red-500 text-sm",children:u})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:v,disabled:o<r,className:`w-full px-4 py-2 rounded text-white ${o<r?"bg-gray-400 cursor-not-allowed":"bg-green-500 hover:bg-green-600"}`,children:"Bayar Sekarang"})}),w&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white p-6 rounded shadow-lg w-80",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Masukkan Password"}),e.jsx("input",{type:"password",value:c,onChange:n=>y(n.target.value),className:"w-full border p-2 rounded mb-4",placeholder:"Masukkan password"}),p&&e.jsx("p",{className:"text-red-500 text-sm mb-2",children:p}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:()=>h(!1),className:"px-4 py-2 border rounded",children:"Batal"}),e.jsx("button",{onClick:C,className:"px-4 py-2 bg-blue-600 text-white rounded",children:"Konfirmasi"})]})]})})]})}export{R as default};
