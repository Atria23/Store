import{r as l,W as S,j as e}from"./app-CI3E5Uil.js";const v=({deposits:f})=>{const[c,o]=l.useState(!1),[x,d]=l.useState(null),[p,g]=l.useState(f),[s,h]=l.useState(null),[i,m]=l.useState(null),{post:j}=S();l.useEffect(()=>{const t=setInterval(()=>{g(r=>r.map(n=>n.status==="pending"&&n.expires_at&&new Date(n.expires_at)-new Date<=0?{...n,status:"expired"}:n))},1e3);return()=>clearInterval(t)},[]);const b=t=>{const r=new Date(t)-new Date;if(r<=0)return"Expired";const n=Math.floor(r/(1e3*60*60)),a=Math.floor(r%(1e3*60*60)/(1e3*60)),D=Math.floor(r%(1e3*60)/1e3);return`${n.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${D.toString().padStart(2,"0")}`},y=t=>{confirm("Are you sure you want to confirm this deposit?")&&(o(!0),d(t),j(`/deposit/confirm/${t}`,{},{onSuccess:()=>{alert("Deposit confirmed successfully!"),o(!1),d(null)},onError:()=>{alert("Failed to confirm deposit."),o(!1),d(null)}}))},N=t=>{h(t)},w=()=>{h(null)},u=(t,r)=>{if(!r)return;m(t);const n=new FormData;n.append("proof_of_payment",r),fetch(`/deposit/upload-proof/${t}`,{method:"POST",body:n,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}).then(a=>a.json()).then(a=>{a.success?(alert("Proof of payment uploaded successfully!"),window.location.href="/deposit"):alert("Failed to upload proof of payment.")}).catch(a=>{console.error("Error uploading proof:",a),alert("An error occurred while uploading proof.")}).finally(()=>m(null))};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Deposit History"}),e.jsx("a",{href:"/deposit/create",children:e.jsx("span",{className:"px-2 py-1 rounded bg-blue-100 text-blue-600",children:"Create Deposit"})}),p.length===0?e.jsx("p",{children:"No deposits found."}):e.jsxs("table",{className:"min-w-full bg-white border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border px-4 py-2",children:"#"}),e.jsx("th",{className:"border px-4 py-2",children:"Get Saldo"}),e.jsx("th",{className:"border px-4 py-2",children:"Total Pay"}),e.jsx("th",{className:"border px-4 py-2",children:"Status"}),e.jsx("th",{className:"border px-4 py-2",children:"Expires In"}),e.jsx("th",{className:"border px-4 py-2",children:"Proof of Payment"}),e.jsx("th",{className:"border px-4 py-2",children:"Actions"})]})}),e.jsx("tbody",{children:p.map(t=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"border px-4 py-2",children:t.id}),e.jsx("td",{className:"border px-4 py-2",children:t.get_saldo}),e.jsx("td",{className:"border px-4 py-2",children:t.total_pay}),e.jsx("td",{className:"border px-4 py-2",children:e.jsx("span",{className:`px-2 py-1 rounded ${t.status==="pending"?"bg-yellow-100 text-yellow-600":t.status==="confirmed"?"bg-green-100 text-green-600":"bg-red-100 text-red-600"}`,children:t.status})}),e.jsx("td",{className:"border px-4 py-2",children:t.status==="pending"?b(t.expires_at):"Expired"}),e.jsx("td",{className:"border px-4 py-2",children:t.proof_of_payment?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("img",{src:`/proof-of-payment/${t.id}`,alt:"Proof of Payment",className:"w-20 h-20 object-cover mb-2"}),t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:`upload-proof-${t.id}`,className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-700 cursor-pointer",children:"Change Proof"}),e.jsx("input",{id:`upload-proof-${t.id}`,type:"file",accept:"image/*",onChange:r=>u(t.id,r.target.files[0]),disabled:i===t.id,className:"hidden"})]})]}):t.status==="confirmed"||new Date(t.expires_at)<=new Date?e.jsx("p",{className:"text-grey-400",children:"N/A"}):t.payment_method==="QRIS"?e.jsx("button",{onClick:()=>y(t.id),className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-700",disabled:c&&x!==t.id,children:c&&x===t.id?"Loading...":"Confirm"}):e.jsxs("div",{children:[e.jsx("input",{type:"file",accept:"image/*",onChange:r=>u(t.id,r.target.files[0]),disabled:i===t.id,className:"text-sm"}),i===t.id&&e.jsx("p",{children:"Uploading..."})]})}),e.jsx("td",{className:"border px-4 py-2 space-y-2",children:e.jsx("button",{onClick:()=>N(t),className:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-700",children:"View Details"})})]},t.id))})]}),s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded shadow-lg max-w-md w-full",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Deposit Details"}),e.jsxs("p",{children:[e.jsx("strong",{children:"ID:"})," ",s.id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Amount:"})," ",s.amount]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Unique Code:"})," ",s.unique_code]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total Pay:"})," ",s.total_pay]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Admin Fee:"})," ",s.admin_fee]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Get Saldo:"})," ",s.get_saldo]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",e.jsx("span",{className:`px-2 py-1 rounded ${s.status==="pending"?"bg-yellow-100 text-yellow-600":s.status==="confirmed"?"bg-green-100 text-green-600":"bg-red-100 text-red-600"}`,children:s.status})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Expires At:"})," ",new Date(s.expires_at).toLocaleString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Created At:"})," ",new Date(s.created_at).toLocaleString()]}),s.proof_of_payment&&e.jsxs("p",{children:[e.jsx("strong",{children:"Proof of Payment:"})," ",e.jsx("a",{href:`/proof-of-payment/${s.id}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:"View Proof"})]}),e.jsx("button",{onClick:w,className:"bg-red-500 text-white px-4 py-2 rounded hover:bg-red-700 mt-4",children:"Close"})]})})]})};export{v as default};
