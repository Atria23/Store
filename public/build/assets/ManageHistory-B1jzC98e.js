import{q as D,r as c,j as e,a as L,W as S,y as A}from"./app-CH2zE8JZ.js";const E=({id:j,ref_id:d,product_name:N,customer_no:g,price:C,status:n,created_at:x,user_id:u,sn:p})=>{const[a,o]=c.useState(!1),b={Sukses:"bg-green-100 text-green-600",Pending:"bg-yellow-100 text-yellow-600",Gagal:"bg-red-100 text-red-600"},w=new Date(x).toLocaleString("id-ID",{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1,timeZone:"Asia/Jakarta"}),y=()=>{o(!0)},{data:m,setData:h,post:v,processing:f,errors:k}=S({id:j,status:n||"",sn:p||""}),t=r=>{r.preventDefault(),console.log("Submit function triggered"),v("/transactions/update",{data:{id:j,status:m.status,sn:m.sn},preserveScroll:!0,onSuccess:()=>{console.log("Update sukses"),o(!1),A.visit(route("manage.history"))},onError:T=>{console.error("Terjadi error saat update:",T)}})},s=r=>r.length>=6?r.slice(0,3)+"****"+r.slice(-3):r.slice(0,3)+(r.length>3?"****":""),{get:i}=S(),l=()=>{i(`/history/${d}`)};return e.jsxs("div",{className:"flex justify-between items-center p-3 border-b-2 border-b-neutral-100 w-full gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsx("div",{className:"w-14 bg-white shadow hidden min-[350px]:flex items-center justify-center rounded-xl",children:e.jsx("img",{src:"/storage/logo.webp",alt:"Company Logo",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex flex-col items-start w-max space-y-[2px]",children:[e.jsx("p",{className:"font-utama font-semibold text-sm truncate w-full max-w-[180px] [@media(max-width:350px)]:max-w-[215px]",children:N}),e.jsxs("p",{className:"w-full font-utama text-sm",children:["ID Tujuan: ",s(g)]}),e.jsxs("p",{className:"w-full max-w-[200px] font-utama text-sm truncate",title:p,children:["SN: ",p]}),e.jsxs("p",{onClick:l,className:"w-full font-utama text-sm text-blue-600 hover:underline cursor-pointer",children:["ID: ",d]})]})]}),e.jsxs("div",{className:"w-full flex flex-col items-end justify-end space-y-1",children:[e.jsxs("a",{href:`/manage-users/${u}/edit`,className:"text-blue-600 hover:underline text-xs",children:["User ID: ",u]}),a?e.jsxs("form",{onSubmit:t,className:"space-y-2 w-full",children:[e.jsxs("select",{value:m.status,onChange:r=>h("status",r.target.value),className:"w-full p-2 rounded-md border",children:[e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Sukses",children:"Sukses"}),e.jsx("option",{value:"Gagal",children:"Gagal"})]}),e.jsx("input",{type:"text",placeholder:"Enter SN",value:m.sn,onChange:r=>h("sn",r.target.value),className:"w-full p-2 rounded-md border"}),e.jsxs("div",{className:"flex justify-between space-x-2 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>o(!1),className:"bg-gray-200 text-gray-700 px-4 py-2 rounded-md",children:"Cancel"}),e.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded-md",children:"Save"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:`w-max-full min-[300px]:flex px-2 py-[2px] text-xs rounded-3xl justify-center ${b[n]}`,children:n}),e.jsx("p",{className:"hidden min-[350px]:flex font-utama text-[12px] text-right",children:w}),e.jsx("button",{onClick:y,className:"text-blue-600 text-sm mt-2",children:"Edit"})]})]})]})},P=()=>{const{transactions:j}=D().props,[d,N]=c.useState(j),[g,C]=c.useState(""),[n,x]=c.useState(1),[u,p]=c.useState("desc"),[a,o]=c.useState({start:"",end:""}),[b,w]=c.useState(!1),y=d.filter(t=>{const s=g.toLowerCase(),i=t.product_name.toLowerCase().includes(s)||t.customer_no.toLowerCase().includes(s)||t.ref_id.toLowerCase().includes(s),l=new Date(t.created_at),r=(!a.start||l>=new Date(a.start))&&(!a.end||l<=new Date(a.end));return i&&r}).sort((t,s)=>{const i=new Date(t.created_at).getTime(),l=new Date(s.created_at).getTime();return i===l?0:u==="desc"?l-i:i-l}),m=t=>{const s=new Date(t);return s.setDate(s.getDate()+1),s.toISOString().split("T")[0]},h=10,v=y.slice((n-1)*h,n*h);c.useEffect(()=>{x(1)},[g,u,a]);const f=Math.ceil(y.length/h),k=()=>{d.forEach(t=>{t.status==="Pending"&&fetch("/transactions/update-status",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector("meta[name='csrf-token']").getAttribute("content")},body:JSON.stringify({transaction_id:t.ref_id})}).then(s=>s.json()).then(s=>{s.success&&N(i=>i.map(l=>l.ref_id===t.ref_id?{...l,status:s.new_status||l.status}:l))}).catch(s=>console.error("Error updating transaction status:",s))})};return c.useEffect(()=>{const t=setInterval(()=>{k()},1e3);return()=>clearInterval(t)},[d]),e.jsxs(e.Fragment,{children:[e.jsx(L,{title:"Manage History"}),e.jsxs("div",{className:"mx-auto w-full max-w-[500px] max-h-[892px] min-h-screen",children:[e.jsxs("div",{className:"fixed top-0 left-1/2 -translate-x-1/2 max-w-[500px] w-full z-10 bg-main",children:[e.jsx("div",{className:"w-full h-max flex flex-row space-x-4 justify-start items-center px-4 py-2 bg-main",children:e.jsxs("div",{className:"w-full h-max flex flex-row space-x-4 items-center justify-start",children:[e.jsx("button",{className:"shrink-0 w-6 h-6",onClick:()=>window.history.back(),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"white",className:"w-6 h-6",children:e.jsx("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})})}),e.jsx("div",{className:"font-utama text-white font-bold text-lg",children:"Kelola Transaksi"})]})}),e.jsxs("div",{className:"w-full h-max flex flex-col space-y-4 items-center justify-start p-4 bg-white shadow-lg",children:[e.jsxs("div",{className:"w-full h-9 flex flex-row mx-auto items-center justify-center pr-2 py-2 rounded-lg bg-neutral-100 border-2 border-gray-200",children:[e.jsx("input",{id:"searchInput",type:"text",className:"bg-transparent border-none flex-grow focus:ring-0 focus:outline-none placeholder-gray-400",placeholder:"Cari id transaksi/tujuan/nama produk",value:g,onChange:t=>C(t.target.value)}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",stroke:"currentColor",strokeWidth:"0.3",className:"w-5 h-5 text-main",children:e.jsx("path",{d:"M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16a6.471 6.471 0 0 0 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zM9.5 14A4.5 4.5 0 1 1 14 9.5 4.505 4.505 0 0 1 9.5 14z"})})]}),e.jsxs("div",{className:"w-full h-max flex flex-row space-x-4 items-center justify-start",children:[e.jsxs("button",{onClick:()=>p(t=>t==="desc"?"asc":"desc"),className:"w-full h-max flex flex-row space-x-2 items-center justify-center px-4 py-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",className:"w-4 h-4 text-main",viewBox:"0 0 16 16",children:e.jsx("path",{fillRule:"evenodd",d:"M8 1a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L7.5 13.293V1.5A.5.5 0 0 1 8 1"})}),e.jsx("span",{className:"text-utama text-sm font-thin text-left align-middle text-blue-600",children:u==="desc"?"Terbaru":"Terlama"})]}),e.jsx("div",{className:"shrink-0 w-px bg-main h-6",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1",className:"w-full h-full",children:e.jsx("line",{x1:"12",y1:"4",x2:"12",y2:"20"})})}),e.jsxs("button",{onClick:()=>w(!b),className:"w-full h-max flex flex-row space-x-2 items-center justify-center px-4 py-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",className:"w-4 h-4 text-main",children:e.jsx("path",{d:"M1.5 1.5A.5.5 0 0 1 2 1h12a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.128.334L10 8.692V13.5a.5.5 0 0 1-.342.474l-3 1A.5.5 0 0 1 6 14.5V8.692L1.628 3.834A.5.5 0 0 1 1.5 3.5zm1 .5v1.308l4.372 4.858A.5.5 0 0 1 7 8.5v5.306l2-.666V8.5a.5.5 0 0 1 .128-.334L13.5 3.308V2z"})}),e.jsx("span",{className:"text-utama text-sm font-thin text-left align-middle text-blue-600",children:"Filter"})]})]})]}),b&&e.jsx("div",{className:"fixed h-screen px-4 inset-0 z-20 flex items-center justify-center bg-gray-800 bg-opacity-50",children:e.jsx("div",{className:"w-full max-w-[328px] p-4 bg-white rounded-lg shadow-lg",children:e.jsxs("div",{className:"w-full h-max flex flex-col space-y-4",children:[e.jsx("button",{className:"w-full flex justify-end",onClick:()=>w(!1),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",className:"w-7 h-7 text-red-500",children:e.jsx("path",{d:"M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293z"})})}),e.jsx("h2",{className:"text-center text-utama text-lg font-medium",children:"Filter Tanggal"}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium text-utama",children:"Tanggal Mulai"}),e.jsx("input",{type:"date",className:"text-sm px-3 py-2 border border-gray-200 rounded-md bg-neutral-100",value:a.start,onChange:t=>o({...a,start:t.target.value})})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium text-utama",children:"Tanggal Akhir"}),e.jsx("input",{type:"date",className:"text-sm px-3 py-2 border border-gray-200 rounded-md bg-neutral-100",value:a.end,min:a.start?m(a.start):"",onChange:t=>o({...a,end:t.target.value})})]})]}),e.jsxs("div",{className:"w-full flex flex-col gap-2 mt-2",children:[e.jsx("button",{onClick:()=>o({start:"",end:""}),className:"w-full border border-red-300 text-red-500 text-sm py-2 rounded hover:bg-red-50 transition",children:"Reset Tanggal"}),e.jsx("button",{onClick:()=>w(!1),className:"w-full bg-blue-600 text-white text-sm py-2 rounded hover:bg-blue-700 transition",children:"Terapkan"})]})]})})})]}),e.jsxs("div",{className:"mb-4 min-h-[756px] pt-[163px] bg-white",children:[v.length>0?v.map(t=>e.jsx(E,{...t},t.ref_id)):e.jsx("div",{className:"flex justify-center items-center h-full mt-6",children:e.jsx("p",{className:"text-gray-500",children:"Tidak ada transaksi ditemukan."})}),f>1&&e.jsx("div",{className:"w-full flex justify-center py-4",children:e.jsxs("div",{className:"flex flex-wrap justify-center items-center gap-1 max-w-full px-2",children:[e.jsx("button",{onClick:()=>x(t=>Math.max(t-1,1)),disabled:n===1,className:`px-2 py-1 text-xs rounded border transition-all ${n===1?"bg-gray-200 text-gray-500 cursor-not-allowed border-gray-200":"bg-white hover:bg-gray-100 text-main border-gray-300"}`,children:"« Prev"}),Array.from({length:f},(t,s)=>s+1).map(t=>e.jsx("button",{onClick:()=>x(t),className:`px-2 py-1 text-xs rounded border transition-all ${t===n?"bg-main text-white border-main":"bg-white hover:bg-gray-100 text-main border-gray-300"}`,children:t},t)),e.jsx("button",{onClick:()=>x(t=>Math.min(t+1,f)),disabled:n===f,className:`px-2 py-1 text-xs rounded border transition-all ${n===f?"bg-gray-200 text-gray-500 cursor-not-allowed border-gray-200":"bg-white hover:bg-gray-100 text-main border-gray-300"}`,children:"Next »"})]})})]})]})]})};export{P as default};
