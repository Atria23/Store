import{q as G,r as o,y as F,j as e,d as y}from"./app-DMmN_QQ9.js";const J=({formula:n,onChange:t})=>{const[w,r]=o.useState([]),[N,p]=o.useState({});o.useEffect(()=>{if(!n)return;console.log("Formula:",n);const c=[];let a;const m=/\{(i\d+a?)\}/g;for(;(a=m.exec(n))!==null;)c.some(d=>d===a[1])||c.push(a[1]);r(c),p(c.reduce((d,b)=>({...d,[b]:""}),{}))},[n]);const v=(c,a)=>{const d=c.includes("a")?a.replace(/\D/g,""):a;p(b=>{const h={...b,[c]:d};console.log("Updated Input Values:",h);let u=n;for(const[x,j]of Object.entries(h))u=u.replaceAll(`{${x}}`,j);return console.log("Updated Formula:",u),t(u),h})};return e.jsxs("div",{className:"bg-gray-100 p-4 rounded-lg mb-4",children:[e.jsx("label",{className:"block font-semibold",children:"Masukkan Data:"}),w.map((c,a)=>e.jsx("input",{type:"text",className:"w-full p-2 border rounded mb-2",placeholder:`Input ${a+1}`,value:N[c]||"",onChange:m=>v(c,m.target.value)},a))]})};function Y(){var U,_;const{category:n,brand:t,brands:w=[],type:r,types:N=[],isPulsaOrData:p,products:v=[],inputTypes:c}=G().props,[a,m]=o.useState(""),[d,b]=o.useState(null),[h,u]=o.useState(""),[x,j]=o.useState(null),[P,O]=o.useState("");o.useState(!1);const[C,R]=o.useState(null),[S,z]=o.useState(null),[K,T]=o.useState(!1),[M,$]=o.useState(!1),[D,W]=o.useState(""),E=N.filter(s=>s.name.toLowerCase().includes(D.toLowerCase())),A=s=>{if(!P&&!a){alert("Masukkan ID Tujuan terlebih dahulu!");return}F.get("/checkout",{id:s.id,customerNo:P,phone:a})},H={Telkomsel:["0811","0812","0813","0821","0822","0823","0852","0853"],Indosat:["0814","0815","0816","0855","0856","0857","0858"],XL:["0817","0818","0819","0859","0877","0878"],Tri:["0895","0896","0897","0898","0899"],Axis:["0831","0832","0833","0838"],Smartfren:["0881","0882","0883","0884","0885","0886","0887","0888","0889"],"By.U":["0851"]};o.useEffect(()=>{if(p){const l=new URLSearchParams(window.location.search).get("phone")||"",i=L(l);m(i),I(i)}},[]);const V=s=>{const l=s.target.value,i=L(l);m(i),d&&clearTimeout(d),b(setTimeout(()=>{I(i),B({phone:i})},1e3))},L=s=>{if(!s)return"";let l=s.replace(/[^0-9]/g,"");return l.startsWith("62")?l="0"+l.substring(2):l.startsWith("+62")&&(l="0"+l.substring(3)),l},I=s=>{if(!s||s.length<4){u("");return}const l=s.substring(0,4);let i=null;if(Object.entries(H).forEach(([k,X])=>{X.includes(l)&&(i=k)}),!i){u("Tidak Diketahui");return}const f=w.find(k=>k.name.toLowerCase().includes(i.toLowerCase())),g=f?f.name:i;u(g),g!==(t==null?void 0:t.name)&&B({phone:s,brand:g})},B=s=>{const l=new URLSearchParams(window.location.search);Object.entries(s).forEach(([f,g])=>{g?l.set(f,g):l.delete(f)});const i=`/c=${n==null?void 0:n.name}/b=${s.brand||(t==null?void 0:t.name)}`+(s.type||r!=null&&r.name?`/t=${s.type||(r==null?void 0:r.name)}`:"")+`?${l.toString()}`;F.get(i,{},{replace:!0})},q=()=>{const s=(r==null?void 0:r.example_image)||(t==null?void 0:t.example_image),l=(r==null?void 0:r.example_id_product)||(t==null?void 0:t.example_id_product);(s||l)&&(R(s),z(l),T(!0))};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx(y,{href:"/",className:"text-blue-600 font-bold",children:"← Kembali"}),e.jsxs("div",{className:"flex items-center gap-3 my-4",children:[(t==null?void 0:t.image)&&e.jsx("img",{src:t.image?`/storage/${t.image}`:"storage/categories/default.png",alt:t.name,className:"w-12 h-12 rounded-full object-cover border border-gray-300"}),e.jsx("h1",{className:"text-2xl font-bold",children:(U=t==null?void 0:t.name)==null?void 0:U.split(" - ")[0]})]}),p&&e.jsxs("div",{className:"bg-gray-100 p-4 rounded-lg mb-4",children:[e.jsx("label",{className:"block font-semibold",children:"Nomor HP:"}),e.jsx("input",{type:"tel",className:"w-full p-2 border rounded",placeholder:"Masukkan nomor HP",value:a,onChange:V}),a&&e.jsxs("p",{className:"text-gray-700 mt-2",children:["Operator: ",e.jsx("strong",{children:h})]})]}),!p&&c.length>0&&e.jsxs("div",{className:"relative w-full",children:[e.jsx(J,{formula:(_=c[0])==null?void 0:_.formula,onChange:s=>O(s),className:"w-full pr-12"}),e.jsx("button",{onClick:q,className:"absolute right-2 top-1/2 -translate-y-1/2 bg-blue-500 text-white p-2 rounded-full shadow-md hover:bg-blue-600 transition",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"8"})]})})]}),K&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white p-5 rounded-lg shadow-lg max-w-md",children:[e.jsx("h2",{className:"text-lg font-bold mb-3",children:"Contoh Format Pengisian"}),C&&e.jsx("img",{src:`/storage/${C}`,alt:"Contoh ID Pelanggan",className:"mb-3 rounded-md"}),S&&e.jsxs("p",{className:"text-gray-700",children:["Contoh ID Pelanggan: ",e.jsx("span",{className:"font-semibold",children:S})]}),e.jsx("button",{onClick:()=>T(!1),className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:"Tutup"})]})}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>$(!0),className:"bg-blue-500 text-white px-4 py-2 rounded w-full",children:"Pilih Type"}),M&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-lg w-96 max-h-[470px] overflow-y-auto",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2 text-center",children:"Pilih Type"}),e.jsx("input",{type:"text",placeholder:"Cari type...",className:"w-full p-2 border rounded mb-2",value:D,onChange:s=>W(s.target.value)}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{href:`/c=${n==null?void 0:n.name}/b=${h||(t==null?void 0:t.name)}/t=all?phone=${a}`,className:"block bg-gray-300 p-2 text-center rounded hover:bg-gray-400",children:"Tampilkan Semua"}),E.length>0?E.map(s=>{var l;return e.jsx(y,{href:`/c=${n==null?void 0:n.name}/b=${h||(t==null?void 0:t.name)}/t=${s==null?void 0:s.name}?phone=${a}`,className:"block bg-blue-500 text-white p-2 text-center rounded hover:bg-blue-600",children:(l=s==null?void 0:s.name)==null?void 0:l.split(" - ")[0]},s.id)}):e.jsx("p",{className:"text-gray-500 text-center",children:"Tidak ada type tersedia."})]}),e.jsx("button",{onClick:()=>$(!1),className:"mt-4 w-full bg-red-500 text-white p-2 rounded hover:bg-red-600",children:"Kembali"})]})})]}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"List Produk"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:v.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 shadow-md bg-white",children:[e.jsx("h3",{className:"text-lg font-semibold",children:s.product_name}),e.jsxs("p",{className:"text-gray-600",children:["Rp ",new Intl.NumberFormat("id-ID").format(s.price)]}),e.jsx("button",{className:"mt-2 bg-blue-500 text-white px-4 py-2 rounded",onClick:()=>j(s),children:"Pilih"})]},s.id))}),x&&e.jsxs("div",{className:"fixed bottom-0 left-0 w-full bg-white p-4 shadow-lg border-t max-h-[470px] flex flex-col justify-between",children:[e.jsxs("div",{className:"overflow-y-auto",children:[e.jsx("h3",{className:"text-lg font-semibold",children:x.product_name}),e.jsx("p",{className:"text-gray-600",children:x.description})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("p",{className:"text-lg font-bold",children:["Rp ",new Intl.NumberFormat("id-ID").format(x.price)]}),e.jsx("button",{onClick:()=>A(x),className:"mt-4 bg-green-500 text-white px-4 py-2 rounded w-full",children:"Checkout"}),e.jsx("button",{className:"mt-2 bg-gray-500 text-white px-4 py-2 w-full rounded",onClick:()=>j(null),children:"Tutup"})]})]})]})}export{Y as default};
