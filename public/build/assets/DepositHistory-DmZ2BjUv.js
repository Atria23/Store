import{r as l,W as P,j as e}from"./app-CkWPU0_3.js";const I=({deposits:y})=>{const[d,i]=l.useState(!1),[x,m]=l.useState(null),[h,N]=l.useState(y),[a,p]=l.useState(null),[c,u]=l.useState(null);P();const[w,g]=l.useState(!1),[_,f]=l.useState(""),o=t=>{f(t),g(!0)},j=()=>{g(!1),f("")};l.useEffect(()=>{const t=setInterval(()=>{N(s=>s.map(r=>r.status==="pending"&&r.expires_at&&new Date(r.expires_at)-new Date<=0?{...r,status:"expired"}:r))},1e3);return()=>clearInterval(t)},[]);const S=t=>{const s=new Date(t)-new Date;if(s<=0)return"Expired";const r=Math.floor(s/(1e3*60*60)),n=Math.floor(s%(1e3*60*60)/(1e3*60)),k=Math.floor(s%(1e3*60)/1e3);return`${r.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}:${k.toString().padStart(2,"0")}`},C=t=>{confirm("Are you sure you want to confirm this deposit?")&&(i(!0),m(t),fetch(`/deposit/confirm/${t}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({})}).then(s=>s.json()).then(s=>{s.success?window.location.reload():alert("Konfirmasi gagal: tidak ditemukan data yang sesuai")}).catch(s=>{alert("Terjadi kesalahan: "+s.message)}).finally(()=>{i(!1),m(null)}))},D=t=>{p(t)},v=()=>{p(null)},b=(t,s)=>{if(!s)return;u(t);const r=new FormData;r.append("proof_of_payment",s),fetch(`/deposit/upload-proof/${t}`,{method:"POST",body:r,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}).then(n=>n.json()).then(n=>{n.success?(alert("Proof of payment uploaded successfully!"),window.location.href="/deposit"):alert("Failed to upload proof of payment.")}).catch(n=>{console.error("Error uploading proof:",n),alert("An error occurred while uploading proof.")}).finally(()=>u(null))};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Deposit History"}),e.jsx("a",{href:"/deposit/create",children:e.jsx("span",{className:"px-2 py-1 rounded bg-blue-100 text-blue-600",children:"Create Deposit"})}),h.length===0?e.jsx("p",{children:"No deposits found."}):e.jsxs("table",{className:"min-w-full bg-white border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border px-4 py-2",children:"#"}),e.jsx("th",{className:"border px-4 py-2",children:"Get Saldo"}),e.jsx("th",{className:"border px-4 py-2",children:"Total Pay"}),e.jsx("th",{className:"border px-4 py-2",children:"Payment Method"}),e.jsx("th",{className:"border px-4 py-2",children:"Admin Account"}),e.jsx("th",{className:"border px-4 py-2",children:"Status"}),e.jsx("th",{className:"border px-4 py-2",children:"Expires In"}),e.jsx("th",{className:"border px-4 py-2",children:"Proof of Payment"}),e.jsx("th",{className:"border px-4 py-2",children:"Actions"})]})}),e.jsx("tbody",{children:h.map(t=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"border px-4 py-2",children:t.id}),e.jsx("td",{className:"border px-4 py-2",children:t.get_saldo}),e.jsx("td",{className:"border px-4 py-2",children:t.total_pay}),e.jsx("td",{className:"border px-4 py-2",children:t.payment_method}),e.jsx("td",{className:"border px-4 py-2",children:t.payment_method==="qris"&&t.admin_account?e.jsxs("div",{children:[e.jsx("img",{src:`/storage/${t.admin_account}`,alt:"QRIS",className:"w-20 h-20 object-cover cursor-pointer",onClick:()=>o(`/storage/${t.admin_account}`)}),e.jsx("button",{onClick:()=>o(`/storage/${t.admin_account}`),className:"text-blue-500 underline text-sm mt-2",children:"Perbesar"})]}):t.payment_method==="qris_manual"&&t.admin_account?e.jsxs("div",{children:[e.jsx("img",{src:`/storage/${t.admin_account}`,alt:"QRIS Manual",className:"w-20 h-20 object-cover cursor-pointer",onClick:()=>o(`/storage/${t.admin_account}`)}),e.jsx("button",{onClick:()=>o(`/storage/${t.admin_account}`),className:"text-blue-500 underline text-sm mt-2",children:"Perbesar"})]}):t.admin_account||"N/A"}),w&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:j,children:e.jsxs("div",{className:"relative",onClick:s=>s.stopPropagation(),children:[e.jsx("img",{src:_,alt:"Full View",className:"max-h-screen"}),e.jsx("button",{onClick:j,className:"absolute top-2 right-2 text-white bg-red-600 px-3 py-1 rounded",children:"Tutup"})]})}),e.jsx("td",{className:"border px-4 py-2",children:e.jsx("span",{className:`px-2 py-1 rounded ${t.status==="pending"?"bg-yellow-100 text-yellow-600":t.status==="confirmed"?"bg-green-100 text-green-600":"bg-red-100 text-red-600"}`,children:t.status})}),e.jsx("td",{className:"border px-4 py-2",children:t.status==="pending"?S(t.expires_at):"Expired"}),e.jsx("td",{className:"border px-4 py-2",children:t.proof_of_payment?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("img",{src:`/proof-of-payment/${t.id}`,alt:"Proof of Payment",className:"w-20 h-20 object-cover mb-2"}),t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:`upload-proof-${t.id}`,className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-700 cursor-pointer",children:"Change Proof"}),e.jsx("input",{id:`upload-proof-${t.id}`,type:"file",accept:"image/*",onChange:s=>b(t.id,s.target.files[0]),disabled:c===t.id,className:"hidden"})]})]}):t.status==="confirmed"||new Date(t.expires_at)<=new Date?e.jsx("p",{className:"text-grey-400",children:"N/A"}):t.payment_method==="qris"?e.jsx("button",{onClick:()=>C(t.id),className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-700",disabled:d&&x!==t.id,children:d&&x===t.id?"Loading...":"Confirm"}):e.jsxs("div",{children:[e.jsx("input",{type:"file",accept:"image/*",onChange:s=>b(t.id,s.target.files[0]),disabled:c===t.id,className:"text-sm"}),c===t.id&&e.jsx("p",{children:"Uploading..."})]})}),e.jsx("td",{className:"border px-4 py-2 space-y-2",children:e.jsx("button",{onClick:()=>D(t),className:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-700",children:"View Details"})})]},t.id))})]}),a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded shadow-lg max-w-md w-full",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Deposit Details"}),e.jsxs("p",{children:[e.jsx("strong",{children:"ID:"})," ",a.id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Amount:"})," ",a.amount]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Unique Code:"})," ",a.unique_code]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total Pay:"})," ",a.total_pay]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Payment Method:"})," ",a.payment_method]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Admin Fee:"})," ",a.admin_fee]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Get Saldo:"})," ",a.get_saldo]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",e.jsx("span",{className:`px-2 py-1 rounded ${a.status==="pending"?"bg-yellow-100 text-yellow-600":a.status==="confirmed"?"bg-green-100 text-green-600":"bg-red-100 text-red-600"}`,children:a.status})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Expires At:"})," ",new Date(a.expires_at).toLocaleString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Created At:"})," ",new Date(a.created_at).toLocaleString()]}),a.proof_of_payment&&e.jsxs("p",{children:[e.jsx("strong",{children:"Proof of Payment:"})," ",e.jsx("a",{href:`/proof-of-payment/${a.id}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:"View Proof"})]}),e.jsx("button",{onClick:v,className:"bg-red-500 text-white px-4 py-2 rounded hover:bg-red-700 mt-4",children:"Close"})]})})]})};export{I as default};
