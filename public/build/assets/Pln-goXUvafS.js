import{r as d,j as e,a as X,y as A}from"./app-Duzs-vCt.js";function V({auth:B}){const[S,y]=d.useState(""),[a,h]=d.useState(null),[r,N]=d.useState(null),[T,w]=d.useState(""),[n,p]=d.useState(null),[o,g]=d.useState(null),[m,x]=d.useState(!1),[k,c]=d.useState(""),[I,v]=d.useState(!1),[_,C]=d.useState(""),[D,F]=d.useState(!1),f=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),P=B.user.balance,l=s=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(s||0),b=d.useMemo(()=>!n||!n.successful?0:n.successful.reduce((s,t)=>s+t.selling_price,0),[n]),O=async s=>{s.preventDefault(),x(!0),c(""),h(null),p(null),g(null);try{const t=await fetch(route("pln.pasca.inquiry"),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":f},body:JSON.stringify({customer_no:S})}),i=await t.json();if(!t.ok)throw new Error(i.message||"Gagal melakukan pengecekan tagihan.");h(i)}catch(t){c(t.message)}finally{x(!1)}},L=async s=>{s.preventDefault(),x(!0),c(""),h(null),p(null),g(null);const t=T.split(/[\n,;\s]+/).map(i=>i.trim()).filter(i=>i.length>=10);if(t.length===0){c("Masukkan setidaknya satu ID Pelanggan yang valid."),x(!1);return}try{const i=await fetch(route("pln.pasca.bulk-inquiry"),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":f},body:JSON.stringify({customer_nos:t})}),u=await i.json();if(!i.ok)throw new Error(u.message||"Gagal melakukan pengecekan tagihan massal.");p(u)}catch(i){c(i.message)}finally{x(!1)}},q=()=>{if(a){if(P<a.selling_price){c("Saldo tidak mencukupi untuk melakukan transaksi.");return}c(""),C(""),v(!0)}},E=()=>{if(n&&n.successful.length>0){if(P<b){c("Saldo Anda tidak mencukupi untuk melakukan semua transaksi ini.");return}c(""),C(""),v(!0)}},z=async s=>{if(s.preventDefault(),!_){c("Silakan masukkan password untuk melanjutkan.");return}x(!0),c("");try{const t=await fetch("/auth/verify-password",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":f},body:JSON.stringify({password:_})}),i=await t.json();if(!t.ok||!i.success)throw new Error("Password yang Anda masukkan salah.");let u;if(a)u=await fetch(route("pln.pasca.payment"),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":f},body:JSON.stringify({customer_no:a.customer_no})});else if(n&&n.successful.length>0){const $=n.successful.map(J=>J.customer_no);u=await fetch(route("pln.pasca.bulk-payment"),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":f},body:JSON.stringify({customer_nos_to_pay:$})})}else throw new Error("Tidak ada tagihan yang siap dibayar.");const j=await u.json();if(!u.ok)throw N(a?j:null),g(n?j.results:null),new Error(j.message||"Gagal melakukan pembayaran.");N(a?j:null),g(n?j.results:null),h(null),p(null),y(""),w(""),v(!1),A.reload({only:["auth"]})}catch(t){c(t.message)}finally{x(!1)}},M=r||o&&o.length>0,R=a||n&&(n.successful.length>0||n.failed.length>0),K=()=>{h(null),p(null),N(null),g(null),c(""),y(""),w("")};return e.jsxs(e.Fragment,{children:[e.jsx(X,{title:"PLN Pascabayar"}),e.jsxs("div",{className:"mx-auto w-full max-w-[500px] bg-gray-50 flex flex-col min-h-screen",children:[e.jsxs("header",{className:"fixed top-0 left-1/2 -translate-x-1/2 max-w-[500px] w-full z-10 flex items-center space-x-4 px-4 py-3 bg-main text-white shadow-md",children:[e.jsx("button",{className:"shrink-0 w-6 h-6",onClick:()=>M||R?K():window.history.back(),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})})}),e.jsx("div",{className:"font-semibold text-lg",children:"PLN Pascabayar"})]}),e.jsx("main",{className:"w-full pt-16 pb-40 px-4 space-y-4",children:e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border",children:M?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-green-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-800 mt-2",children:"Pembayaran Selesai"}),e.jsx("p",{className:"text-sm text-gray-500",children:r?"Pembayaran Tagihan PLN Pascabayar":"Pembayaran Tagihan PLN Pascabayar Massal"})]}),r&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Pembayaran"}),e.jsx("p",{className:"text-3xl font-bold text-main",children:l(r.selling_price)})]}),o&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Pembayaran Berhasil"}),e.jsx("p",{className:"text-3xl font-bold text-main",children:l(o.filter(s=>s.status==="Sukses").reduce((s,t)=>s+t.selling_price,0))})]}),e.jsx("h4",{className:"font-semibold text-md text-gray-800 pb-1 border-b",children:"Rincian Pembayaran Massal"}),o.map((s,t)=>e.jsxs("div",{className:`border p-3 rounded-lg ${s.status==="Sukses"?"border-green-300 bg-green-50":"border-red-300 bg-red-50"}`,children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"ID Pelanggan"}),e.jsx("span",{className:"font-medium text-gray-900",children:s.customer_no})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Nama Pelanggan"}),e.jsx("span",{className:"font-medium text-gray-900 text-right",children:s.customer_name})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Jumlah Bayar"}),e.jsx("span",{className:"font-bold",children:l(s.selling_price)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Status"}),e.jsx("span",{className:`font-bold ${s.status==="Sukses"?"text-green-600":"text-red-600"}`,children:s.status})]}),s.message&&s.status!=="Sukses"&&e.jsxs("p",{className:"text-xs text-red-500 mt-1",children:["Pesan: ",s.message]})]},t))]}),((r==null?void 0:r.diskon)>0||o&&o.some(s=>s.diskon>0))&&e.jsxs("div",{className:"text-center text-sm text-green-600 font-semibold bg-green-50 p-2 rounded-lg",children:[(r==null?void 0:r.diskon)>0&&`Anda hemat ${l(r.diskon)}!`,o&&!r&&`Total diskon: ${l(o.reduce((s,t)=>s+(t.diskon||0),0))}!`]}),r&&e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx("h4",{className:"font-semibold text-md text-gray-800 pb-1 border-b",children:"Detail Pelanggan"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Nama"}),e.jsx("span",{className:"font-medium text-right",children:r.customer_name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"ID Pelanggan"}),e.jsx("span",{className:"font-medium",children:r.customer_no})]})]}),e.jsx("button",{onClick:()=>A.visit(route("postpaid.history.index")),className:"w-full py-2 px-4 border border-main text-main font-semibold rounded-lg hover:bg-blue-50 transition-colors",children:"Riwayat Transaksi"}),e.jsx("button",{onClick:()=>{N(null),g(null),h(null),p(null),y(""),w("")},className:"w-full py-2 px-4 bg-main text-white font-semibold rounded-lg hover:bg-blue-700",children:"Transaksi Lagi"})]}):R?e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"w-full font-semibold text-md text-center text-gray-800",children:a?"Detail Tagihan":"Ringkasan Pengecekan Tagihan Massal"}),e.jsx("div",{className:"w-full h-px bg-gray-200"}),a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Nomor Pelanggan"}),e.jsx("span",{className:"font-medium text-gray-900",children:a.customer_no})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Nama Pelanggan"}),e.jsx("span",{className:"font-medium text-gray-900 text-right",children:a.customer_name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Tarif/Daya"}),e.jsx("span",{className:"font-medium text-gray-900",children:`${a.desc.tarif} / ${a.desc.daya}VA`})]})]}),a.desc.detail&&a.desc.detail.length>0&&e.jsxs("div",{className:"space-y-2 text-sm border-t pt-2",children:[e.jsx("h4",{className:"font-semibold text-md text-gray-800 pb-1",children:"Rincian per periode Tagihan"}),a.desc.detail.map((s,t)=>e.jsxs("div",{className:"border-b pb-2 mb-2 last:border-b-0 last:pb-0",children:[e.jsxs("p",{className:"font-medium text-gray-700",children:["Periode: ",s.periode]}),e.jsxs("div",{className:"flex justify-between pl-2",children:[e.jsx("span",{className:"text-gray-500",children:"Nilai Tagihan"}),e.jsx("span",{className:"font-medium",children:l(s.nilai_tagihan)})]}),e.jsxs("div",{className:"flex justify-between pl-2",children:[e.jsx("span",{className:"text-gray-500",children:"Admin (per periode)"}),e.jsx("span",{className:"font-medium",children:l(s.admin)})]}),s.denda>0&&e.jsxs("div",{className:"flex justify-between pl-2",children:[e.jsx("span",{className:"text-gray-500",children:"Denda (per periode)"}),e.jsx("span",{className:"font-medium text-red-600",children:l(s.denda)})]}),e.jsxs("div",{className:"flex justify-between pl-2",children:[e.jsx("span",{className:"text-gray-500",children:"Meter Awal - Akhir"}),e.jsxs("span",{className:"font-medium",children:[s.meter_awal," - ",s.meter_akhir]})]})]},t))]}),e.jsxs("div",{className:"space-y-2 text-sm border-t pt-2",children:[e.jsx("h4",{className:"font-semibold text-md text-gray-800 pb-1",children:"Ringkasan Pembayaran"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Total Nilai Tagihan"}),e.jsx("span",{className:"font-medium text-gray-900",children:l(a.price)})]}),a.denda>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Total Denda"}),e.jsx("span",{className:"font-medium text-red-600",children:l(a.denda)})]}),a.desc.detail&&a.desc.detail.length>0&&(()=>{const s=a.desc.detail.reduce((t,i)=>t+parseFloat(i.admin||0),0);return e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Total Biaya Admin"}),e.jsx("span",{className:"font-medium text-gray-900",children:l(s)})]})})(),a.diskon>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Diskon"}),e.jsxs("span",{className:"font-medium text-green-600",children:["- ",l(a.diskon)]})]})]}),e.jsx("div",{className:"w-full h-px bg-gray-200"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold text-gray-800",children:"Total Pembayaran"}),e.jsx("span",{className:"font-bold text-xl text-main",children:l(a.selling_price)})]})]}),n&&e.jsxs("div",{className:"space-y-4",children:[n.successful.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"font-semibold text-gray-800",children:["Tagihan Berhasil Ditemukan (",n.successful.length,")"]}),n.successful.map((s,t)=>e.jsxs("div",{className:"border border-blue-200 bg-blue-50 p-3 rounded-lg space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"ID Pelanggan"}),e.jsx("span",{className:"font-medium text-gray-900",children:s.customer_no})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Nama"}),e.jsx("span",{className:"font-medium text-gray-900 text-right",children:s.customer_name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Tagihan + Denda + Admin"}),e.jsx("span",{className:"font-medium",children:l(s.price+s.denda+(s.admin||0))})]}),s.diskon>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Diskon"}),e.jsxs("span",{className:"font-medium text-green-600",children:["- ",l(s.diskon)]})]}),e.jsxs("div",{className:"flex justify-between font-semibold",children:[e.jsx("span",{className:"text-gray-700",children:"Total Bayar"}),e.jsx("span",{className:"text-main",children:l(s.selling_price)})]})]},t))]}),n.failed.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"font-semibold text-red-700 mt-4",children:["Tagihan Gagal Ditemukan (",n.failed.length,")"]}),n.failed.map((s,t)=>e.jsxs("div",{className:"border border-red-300 bg-red-50 p-3 rounded-lg space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"ID Pelanggan"}),e.jsx("span",{className:"font-bold text-red-800",children:s.customer_no})]}),e.jsx("p",{className:"text-xs text-red-600 mt-1",children:s.message})]},t))]}),n.successful.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full h-px bg-gray-200 mt-4"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold text-gray-800",children:"Total Pembayaran Massal"}),e.jsx("span",{className:"font-bold text-xl text-main",children:l(b)})]})]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("form",{onSubmit:O,className:"space-y-4 border-b pb-6 mb-6",children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-800",children:"Cek Tagihan Satuan"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"customer_no",className:"block text-sm font-medium text-gray-700 mb-1",children:"ID Pelanggan PLN"}),e.jsx("input",{id:"customer_no",type:"text",inputMode:"numeric",pattern:"[0-9]*",value:S,onChange:s=>{const t=s.target.value;/^\d*$/.test(t)&&y(t)},onWheel:s=>s.target.blur(),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",disabled:m,required:!0,placeholder:"Masukkan ID Pelanggan"})]}),e.jsx("button",{type:"submit",disabled:m||!S,className:"w-full py-2 px-4 bg-main text-white font-semibold rounded-lg hover:bg-blue-700 disabled:bg-gray-400",children:m?"Mengecek...":"Lanjutkan"})]}),e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-800",children:"Cek Tagihan Massal"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"customer_nos_bulk",className:"block text-sm font-medium text-gray-700 mb-1",children:"ID Pelanggan PLN (Pisahkan dengan koma, spasi, atau baris baru)"}),e.jsx("textarea",{id:"customer_nos_bulk",value:T,onChange:s=>w(s.target.value),rows:"5",className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",disabled:m,required:!0,placeholder:`Contoh:
123456789012
098765432109, 112233445566`})]}),e.jsx("button",{type:"submit",disabled:m||!T.trim(),className:"w-full py-2 px-4 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 disabled:bg-gray-400",children:m?"Mengecek Massal...":"Lanjutkan Massal"})]}),k&&!I&&e.jsx("p",{className:"text-red-500 text-xs text-center pt-2",children:k})]})})}),(a||n&&n.successful.length>0)&&!M&&e.jsx("footer",{className:"fixed bottom-0 left-1/2 -translate-x-1/2 w-full max-w-[500px] p-4 bg-white shadow-[0_-2px_5px_rgba(0,0,0,0.1)] rounded-t-xl",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Pembayaran"}),e.jsx("p",{className:"text-xl font-bold text-main",children:l(a?a.selling_price:b)})]}),e.jsx("button",{onClick:a?q:E,disabled:P<(a?a.selling_price:b),className:"px-6 py-2 rounded-lg font-semibold text-white bg-main hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed",children:P<(a?a.selling_price:b)?"Saldo Kurang":"Bayar Sekarang"})]})}),I&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-sm space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-center",children:"Konfirmasi Pembayaran"}),e.jsxs("form",{onSubmit:z,children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:D?"text":"password",value:_,onChange:s=>C(s.target.value),className:"w-full border p-2 pr-10 rounded",placeholder:"Masukkan password Anda",autoFocus:!0}),e.jsx("button",{type:"button",onClick:()=>F(!D),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500",children:D?e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"currentColor",viewBox:"0 0 16 16",children:[e.jsx("path",{d:"m10.79 12.912-1.614-1.615a3.5 3.5 0 0 1-4.474-4.474l-2.06-2.06C.938 6.278 0 8 0 8s3 5.5 8 5.5a7 7 0 0 0 2.79-.588M5.21 3.088A7 7 0 0 1 8 2.5c5 0 8 5.5 8 5.5s-.939 1.721-2.641 3.238l-2.062-2.062a3.5 3.5 0 0 0-4.474-4.474z"}),e.jsx("path",{d:"M5.525 7.646a2.5 2.5 0 0 0 2.829 2.829zm4.95.708-2.829-2.83a2.5 2.5 0 0 1 2.829 2.829zm3.171 6-12-12 .708-.708 12 12z"})]}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"currentColor",viewBox:"0 0 16 16",children:[e.jsx("path",{d:"M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0"}),e.jsx("path",{d:"M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8m8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7"})]})})]}),k&&e.jsx("p",{className:"text-red-500 text-xs text-center pt-2",children:k}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>v(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg",children:"Batal"}),e.jsx("button",{type:"submit",disabled:m,className:"px-4 py-2 text-sm font-medium text-white bg-main hover:bg-blue-700 rounded-lg disabled:bg-gray-400",children:m?"Memproses...":"Konfirmasi"})]})]})]})})]})]})}export{V as default};
